<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>兌換外幣再做定期存款 收益計算機 - 老Best的大自在空間</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="fx-deposit-return-styles.css">
</head>
<body>
    <div class="container">
        <!-- 页面顶部 HEADER - 将通过JavaScript动态加载 -->
        <header class="page-header">
            <!-- Header内容将通过JavaScript动态加载 -->
        </header>

        <div class="page-content">
            <div class="page-header-content">
                <h1>兌換外幣再做定期存款 收益計算機</h1>
                <p>兌匯外幣再做定存時，兌換匯率高了，定存要存多久才賺回來呢?</p>
                <p>兌匯率下降了，現在兌回來會虧很多嗎? 應不應該賣出呢?</p>
                <p>使用以下計算機就能進行評估需要多久才能賺回匯率差價</p>
            </div>
            <main>

                
                <div class="calculator-container">
                    <form id="fxDepositForm">
                        <div class="form-group">
                            <label>貨幣選擇</label>
                            <div class="currency-selector">
                                <div class="form-col">
                                    <select id="fromCurrency" required>
                                        <option value="">選擇賣出貨幣</option>
                                        <option value="HKD">港幣 (HKD)</option>
                                        <option value="USD">美元 (USD)</option>
                                        <option value="RMB">人民幣 (RMB)</option>
                                        <option value="AUD">澳元 (AUD)</option>
                                        <option value="CAD">加拿大元 (CAD)</option>
                                        <option value="NZD">紐西蘭元 (NZD)</option>
                                        <option value="EUR">歐元 (EUR)</option>
                                        <option value="GBP">英鎊 (GBP)</option>
                                        <option value="SGD">新加坡元 (SGD)</option>
                                        <option value="CHF">瑞士法郎 (CHF)</option>
                                    </select>
                                </div>
                                <div class="exchange-arrow">→</div>
                                <div class="form-col">
                                    <select id="toCurrency" required>
                                        <option value="">選擇存入貨幣</option>
                                        <option value="HKD">港幣 (HKD)</option>
                                        <option value="USD">美元 (USD)</option>
                                        <option value="RMB">人民幣 (RMB)</option>
                                        <option value="AUD">澳元 (AUD)</option>
                                        <option value="CAD">加拿大元 (CAD)</option>
                                        <option value="NZD">紐西蘭元 (NZD)</option>
                                        <option value="EUR">歐元 (EUR)</option>
                                        <option value="GBP">英鎊 (GBP)</option>
                                        <option value="SGD">新加坡元 (SGD)</option>
                                        <option value="CHF">瑞士法郎 (CHF)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="exchangeRate">過去兌換匯率(<span id="toCurrencyLabel">存入貨幣</span>: <span id="fromCurrencyLabel">賣出貨幣</span>)</label>
                                <input type="number" id="exchangeRate" min="0" step="0.0001" required>
                                <div class="info-text">1 <span id="toCurrencyLabel">存入貨幣</span> = ? <span id="fromCurrencyLabel">賣出貨幣</span></div>
                            </div>
                            <div class="form-col">
                                <label for="amount">存入 <span id="toCurrencyLabel">存入貨幣</span> 金額</label>
                                <input type="number" id="amount" min="0" step="0.01" required>
                                <div class="info-text" id="exchangeReference">賣出 <span id="fromCurrencyRef">賣出貨幣</span> 0 ，存入 <span id="toCurrencyRef">存入貨幣</span> 0</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="currentRate">當前兌換匯率</label>
                                <input type="number" id="currentRate" min="0" step="0.0001" required>
                                <div class="info-text">1 <span id="toCurrencyLabel2">存入貨幣</span> = ? <span id="fromCurrencyLabel2">賣出貨幣</span></div>
                            </div>
                            <div class="form-col">
                                <label for="depositPeriod">存款期</label>
                                <select id="depositPeriod" required>
                                    <option value="">選擇存款期</option>
                                    <option value="7">7天</option>
                                    <option value="14">14天</option>
                                    <option value="30">1個月</option>
                                    <option value="90">3個月</option>
                                    <option value="180">6個月</option>
                                    <option value="270">9個月</option>
                                    <option value="365">12個月</option>
                                    <option value="730">24個月</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="interestRate">年利率 (%)</label>
                                <input type="number" id="interestRate" min="0" step="0.01" required>
                            </div>
                            <div class="form-col">
                                <label for="dayCountConvention">該幣種之一年總天數</label>
                                <select id="dayCountConvention" required>
                                    <option value="360">360天 (預設)</option>
                                    <option value="365">365天 (英鎊, 新加坡元等)</option>
                                    <option value="366">366天 (港元閏年)</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit">計算</button>
                    </form>
                    
                    <div class="result-container" id="resultContainer" style="display: none;">
                        <h2>計算結果</h2>
                        <div class="result-item">
                            <h3>存款詳情</h3>
                            <p id="depositDetails"></p>
                        </div>
                        <div class="result-item">
                            <h3>到期利息收益</h3>
                            <p id="interestAmount"></p>
                        </div>
                        <div class="result-item">
                            <h3>匯率差價收益</h3>
                            <div id="exchangeLoss"></div>
                        </div>
                        <div class="result-item">
                            <h3>淨收益</h3>
                            <p id="netProfit"></p>
                        </div>
                        <div class="result-item">
                            <h3>回本所需時間</h3>
                            <p id="breakevenTime"></p>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- 页面底部 FOOTER - 将通过JavaScript动态加载 -->
            <footer>
                <!-- Footer内容将通过JavaScript动态加载 -->
            </footer>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fromCurrency = document.getElementById('fromCurrency');
            const toCurrency = document.getElementById('toCurrency');
            const fromCurrencyLabel = document.getElementById('fromCurrencyLabel');
            const toCurrencyLabel = document.getElementById('toCurrencyLabel');
            const fromCurrencyLabel2 = document.getElementById('fromCurrencyLabel2');
            const toCurrencyLabel2 = document.getElementById('toCurrencyLabel2');
            const dayCountConvention = document.getElementById('dayCountConvention');
            const form = document.getElementById('fxDepositForm');
            const resultContainer = document.getElementById('resultContainer');
            
            // 更新货币标签和汇率参考
            function updateCurrencyLabels() {
                const fromValue = fromCurrency.value || '賣出貨幣';
                const toValue = toCurrency.value || '存入貨幣';
                
                // 更新所有货币标签
                fromCurrencyLabel.textContent = fromValue;
                toCurrencyLabel.textContent = toValue;
                fromCurrencyLabel2.textContent = fromValue;
                toCurrencyLabel2.textContent = toValue;
                
                // 更新表单标签中的货币文本
                const amountLabel = document.querySelector('label[for="amount"]');
                amountLabel.innerHTML = `存入 <span id="toCurrencyLabel">${toValue}</span> 金額`;
                
                const exchangeRateLabel = document.querySelector('label[for="exchangeRate"]');
                exchangeRateLabel.innerHTML = `過去兌換之匯率(<span id="toCurrencyLabel">${toValue}</span>: <span id="fromCurrencyLabel">${fromValue}</span>)`;
                
                const currentRateInfo = document.querySelector('#currentRate').parentElement.querySelector('.info-text');
                currentRateInfo.innerHTML = `1 <span id="toCurrencyLabel2">${toValue}</span> = ? <span id="fromCurrencyLabel2">${fromValue}</span>`;
                
                const exchangeRateInfo = document.querySelector('#exchangeRate').parentElement.querySelector('.info-text');
                exchangeRateInfo.innerHTML = `1 <span id="toCurrencyLabel">${toValue}</span> = ? <span id="fromCurrencyLabel">${fromValue}</span>`;
                
                // 更新汇率参考文本中的货币
                document.getElementById('fromCurrencyRef').textContent = fromValue;
                document.getElementById('toCurrencyRef').textContent = toValue;
                
                // 更新汇率参考计算
                updateExchangeReference();
                
                // 根据选择的货币自动设置天数计算基准
                if (toValue === 'HKD') {
                    // 检查今年是否为闰年
                    const currentYear = new Date().getFullYear();
                    const isLeapYear = (currentYear % 4 === 0 && currentYear % 100 !== 0) || (currentYear % 400 === 0);
                    dayCountConvention.value = isLeapYear ? '366' : '365';
                } else if (toValue === 'GBP' || toValue === 'SGD') {
                    dayCountConvention.value = '365';
                } else {
                    dayCountConvention.value = '360';
                }
            }
            
            // 更新汇率参考计算
            function updateExchangeReference() {
                const amount = parseFloat(document.getElementById('amount').value) || 0;
                const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
                const fromValue = fromCurrency.value || '賣出貨幣';
                const toValue = toCurrency.value || '存入貨幣';
                
                // 计算兑换金额（B货币兑换为A货币）
                const exchangedAmount = amount * exchangeRate;
                
                // 更新汇率参考文本
                const exchangeReference = document.getElementById('exchangeReference');
                exchangeReference.innerHTML = `賣出 <span id="fromCurrencyRef">${fromValue}</span> ${formatNumber(exchangedAmount)} ，存入 <span id="toCurrencyRef">${toValue}</span> ${formatNumber(amount)}`;
            }
            
            // 格式化数字，添加千位分隔符
            function formatNumber(num) {
                return num.toLocaleString('zh-HK', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
            
            // 监听货币选择变化
            fromCurrency.addEventListener('change', updateCurrencyLabels);
            toCurrency.addEventListener('change', updateCurrencyLabels);
            
            // 监听输入变化
            document.getElementById('amount').addEventListener('input', updateExchangeReference);
            document.getElementById('exchangeRate').addEventListener('input', updateExchangeReference);
            
            // 表单提交处理
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 获取表单数据
                const amount = parseFloat(document.getElementById('amount').value); // 现在这是B货币的金额
                const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
                const currentRate = parseFloat(document.getElementById('currentRate').value);
                const depositPeriod = parseInt(document.getElementById('depositPeriod').value);
                const interestRate = parseFloat(document.getElementById('interestRate').value) / 100;
                const dayCount = parseInt(dayCountConvention.value);
                
                // 验证货币选择
                if (fromCurrency.value === toCurrency.value) {
                    alert('賣出貨幣和存入貨幣不能相同');
                    return;
                }
                
                // 计算兑换金额（B货币兑换为A货币）
                const exchangedAmount = amount * exchangeRate;
                
                // 计算利息（使用B货币计算）
                const interest = amount * interestRate * (depositPeriod / dayCount);
                
                // 计算汇率差价（绝对值，保留正负）
                const currentExchangeValue = amount * currentRate;
                const originalExchangeValue = exchangedAmount;
                const exchangeLoss = (currentRate - exchangeRate) * amount; // 保留正负值
                
                // 计算净收益（将利息换回A货币后减去汇率差价）
                const interestInFromCurrency = interest * currentRate;
                const netProfit = interestInFromCurrency + exchangeLoss; // 使用绝对值计算净收益
                
                // 计算回本所需时间（天数）
                const dailyInterestRate = interestRate / dayCount;
                const dailyInterestInFromCurrency = (amount * dailyInterestRate) * currentRate;
                const daysToBreakeven = Math.abs(exchangeLoss) / dailyInterestInFromCurrency; // 使用绝对值计算回本时间
                
                // 获取货币符号
                function getCurrencySymbol(currency) {
                    const symbols = {
                        'HKD': 'HK$',
                        'USD': '$',
                        'RMB': '¥',
                        'AUD': 'A$',
                        'CAD': 'C$',
                        'NZD': 'NZ$',
                        'EUR': '€',
                        'GBP': '£',
                        'SGD': 'S$',
                        'CHF': 'Fr'
                    };
                    return symbols[currency] || currency;
                }
                
                // 格式化金额显示（不包含货币代号）
                function formatCurrency(amount, currency) {
                    const symbol = getCurrencySymbol(currency);
                    return `${symbol}${formatNumber(amount)}`;
                }
                
                // 格式化带符号的金额显示（不包含货币代号）
                function formatCurrencyWithSign(amount, currency) {
                    const symbol = getCurrencySymbol(currency);
                    const sign = amount >= 0 ? '+' : '-';
                    const absAmount = Math.abs(amount);
                    const formattedNumber = formatNumber(absAmount);
                    const colorClass = amount >= 0 ? 'positive' : 'negative';
                    return `<span class="${colorClass}">${sign} ${symbol}${formattedNumber}</span>`;
                }
                
                // 显示结果
                document.getElementById('depositDetails').textContent = 
                    `存款金額: ${formatCurrency(amount, toCurrency.value)} (存款期: ${depositPeriod}天, 年利率: ${(interestRate * 100).toFixed(2)}%)`;
                
                document.getElementById('interestAmount').textContent = 
                    `${formatCurrency(interest, toCurrency.value)} (${formatCurrency(interestInFromCurrency, fromCurrency.value)})`;
                
                // 显示汇率差价详情
                const exchangeLossDetails = 
                    `過去兌換之匯率: ${formatCurrency(exchangedAmount, fromCurrency.value)} → ${formatCurrency(amount, toCurrency.value)}<br>` +
                    `當天匯率: ${formatCurrency(currentExchangeValue, fromCurrency.value)} → ${formatCurrency(amount, toCurrency.value)}<br>` +
                    `匯率差價: ${formatCurrencyWithSign(exchangeLoss, fromCurrency.value)}`;
                
                document.getElementById('exchangeLoss').innerHTML = exchangeLossDetails;
                
// 显示净收益，根据正负值使用不同的符号和颜色，并显示计算公式
const netProfitElement = document.getElementById('netProfit');
const netProfitSymbol = netProfit >= 0 ? '+' : '-';
const netProfitAbs = Math.abs(netProfit);

// 创建净收益计算公式的详细说明
const netProfitFormula = 
    `計算公式: 到期利息收益 + 匯率差價收益<br>` +
    `計算結果: ${formatCurrency(interestInFromCurrency, fromCurrency.value)} ${exchangeLoss >= 0 ? '+' : '+'}${(formatCurrency(exchangeLoss, fromCurrency.value))} = ${formatCurrencyWithSign(netProfit, fromCurrency.value)}`;

netProfitElement.innerHTML = 
    `<div class="calculation-details">${netProfitFormula}</div>` ;

// 显示回本所需时间，增加公式及说明
const breakevenElement = document.getElementById('breakevenTime');
if (daysToBreakeven > 0) {  // 当回本所需时间大于0时显示计算公式
    const breakevenFormula = 
        `公式: 匯率差價 ÷ 每日淨收益<br>` +
        `計算: ${formatCurrency(Math.abs(exchangeLoss), fromCurrency.value)} ÷ ${formatCurrency(dailyInterestInFromCurrency, fromCurrency.value)}<br>` +
        `結果: ${daysToBreakeven.toFixed(1)} 天`;
    
    // 当汇率差价为正数时，显示鼓励信息
    if (exchangeLoss > 0) {
        breakevenElement.innerHTML = 
            breakevenFormula + 
            `<div class="action-message positive">太厲害了！你除了賺了利息之餘又賺了匯差！</div>`;
    } else {
        breakevenElement.innerHTML = breakevenFormula;
        
        // 只有当汇率差价为负数时才显示下一步行动
        const remainingDays = depositPeriod - daysToBreakeven;
        const nextActionElement = document.createElement('div');
        nextActionElement.className = 'next-action';
        
        if (remainingDays >= 0) {
            nextActionElement.innerHTML = 
                `<div class="remaining-days positive">${remainingDays.toFixed(1)} 天</div>` +
                `<div class="action-message positive">恭喜你，已回本了！</div>`;
        } else {
            nextActionElement.innerHTML = 
                `<div class="remaining-days negative">${Math.abs(remainingDays).toFixed(1)} 天</div>` +
                `<div class="action-message negative">親愛的老Best，你可能要努力多少少才能賺回匯差的損失呢? 加油吧~</div>`;
        }
        
        breakevenElement.appendChild(nextActionElement);
    }
} else {  // 当回本时间为0或负数时
    breakevenElement.textContent = '已經回本';
    breakevenElement.className = 'positive';
}




                
                // 显示结果容器
                resultContainer.style.display = 'block';
                
                // 滚动到结果区域
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
